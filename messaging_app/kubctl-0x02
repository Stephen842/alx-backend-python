#!/usr/bin/env zsh

set -e

echo "Deploying BLUE version..."
kubectl apply -f blue_deployment.yaml

echo "Deploying GREEN version..."
kubectl apply -f green_deployment.yaml

echo "Checking pods..."
kubectl get pods

echo "Checking logs for GREEN deployment..."
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath="{.items[0].metadata.name}")

kubectl logs "$GREEN_POD" || echo "Could not fetch logs"

echo "Blue-Green deployment applied successfully."
